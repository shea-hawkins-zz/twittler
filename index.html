<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <script src="rx.lite.js"></script>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <script>
      function createTweet(tweet) {
        var $tweet = $('<div></div>');
        var $user = $('<h1></h1>');
        var $message = $('<h2></h2>');
        var $timestamp = $('<span></span>');
        $user.text(tweet.user).addClass("user");
        $message.text(tweet.message).addClass("message");
        $timestamp.text(tweet.created_at).addClass("timestamp");
        $tweet.append($user);
        $tweet.append($message);
        $tweet.append($timestamp);
        $tweet.addClass("tweet");
        return $tweet;
      };
      // Observable sequence that returns the tweet stream, most recent last.
      var tweetStream = Rx.Observable.create(observer => {
        var streamLength = streams.home.length;
        setInterval(function() {
          // Check the streamlength and compares against previous values.
          // Updates the streamlength if necessary.
          if (streams.home.length !== streamLength) {
            for (var i = streamLength; i < streams.home.length; i++) {
              observer.onNext(streams.home[i]);
            }
            streamLength = streams.home.length;
          }
        }, 1000);
        streams.home.reverse().forEach(x => {
          observer.onNext(x);
        });
      });
      $(document).ready(function(){
        var $body = $('body');
        $body.html('');
        tweetStream.subscribe(
          function (tweet) {
            var $jTweet = createTweet(tweet);
            $body.prepend($jTweet);
          }
        );
      });
    </script>
  </body>
</html>
